# gf-dbdump

gf-dbdump is a command-line tool designed to simplify dumping table rows in a database. It supports drivers for Spanner and SQLite3 and provides a standardized interface to dump . By utilizing a JSON-based input format and providing consistent functionality across data sources, it simplifies the task of defining and managing the data to be inserted.

## Usage

```sh
gf-dbdump [-schema <schema-json>] <driver> <data-source>
gf-dbdump -h | --help
```

To use gf-dbdump with Spanner, specify `spanner` as the `<driver>` and provide a string in the format `projects/<project>/instances/<instance>/databases/<database>` as the `<data-source>`. In this format, `<project>` represents the name of your Google Cloud Platform (GCP) project, `<instance>` is the name of your Spanner instance in the GCP project, and `<database>` is the name of the database within the Spanner instance.

To use gf-dbdump with SQLite3, set `sqlite3` as the `<driver>` and provide a connection string as the `<data-source>`.
The connection string should follow the format described in [https://github.com/mattn/go-sqlite3#connection-string](https://github.com/mattn/go-sqlite3#connection-string), such as `file:test.db?cache=shared&mode=memory`.


`gf-dbdump` fetches schema information to prepare for the deletion and saves the information to a cache file. If the cache file already exists then `gf-dbdump` uses tht file instead of  fetching the schema information again. To specify the cache file, specify a path of the file as `<schema-json>` using the `-schema` option. The format of the cache file should follow the JSON format described in the Output section in the README.md file of [dbschema](../dbschema/README.md). The default value for `<schema-json>` is `.gf-schema.json`.


## Input

gf-dbdump expects a JSON array as input from stdin. The JSON array should have the following structure `DBDumpInput`:

```ts
// list of the table names to be dumped.
type DBDumpInput = string[]
```

Here's an example:
```sh
[ "Comment", "User" ]
```

In this example, the JSON input instructs gf-dbdump to dump existing rows in the Comment and User table.

## Output

gf-dbdump outputs the rows in specified tables to stdout in JSON format. The output is represented as te following structure `DBDumpOutput`:

There is no specific output generated by gf-dbdump.
gf-dbdump expects a JSON array as input from stdin. The JSON array should have the following structure `DBInitInput`:

```ts
type DBDumpOutput = {
    // mapping from table name to list of rows.
    [table: string]: Row[]
}[]
type Row = { 
    // mapping from column name to column value in a row
    [column: string]: ColumnValue
}
// column value in a row can take the following types
type ColumnValue = null | number | boolean | string | any
```

Here's an example:
```json
{
    "User": [
        { "id": 1, "name": "Jumpaku", "isGuest": false},
        { "id": 2, "name": null, "isGuest": true}
    ],
    "Comment": [
        { "id": 1, "userId": 1, "content": "Hello" },
        { "id": 2, "userId": 1, "content": "Bye" }
    ]
}
```

In this example, the JSON output represents that the table User contains two users and Comment table contains two comments.
